name: GitHub Actions CI
run-name: ${{ github.actor }} is CI out GitHub Actions ğŸš€
on: [push]
jobs:
  # åªéœ€è¦å®šä¹‰ä¸€ä¸ªjobå¹¶å‘½åä¸ºCI
  Continuous-Integration:
    runs-on: ubuntu-latest
    steps:

      - name: Check out repository codeï¼ˆæ‹‰å–é¡¹ç›®ä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup nodeï¼ˆå½“å‰ç¯å¢ƒä¸‹è½½nodeï¼‰
        uses: actions/setup-node@v3
        with:
          node-version: "14.x"
          registry-url: https://registry.npmjs.com/

      - name: Check Cacheï¼ˆæ£€æŸ¥ç¼“å­˜ï¼‰
        # å¦‚æœkeyå‘½ä¸­ç¼“å­˜åˆ™ç›´æ¥å°†ç¼“å­˜çš„æ–‡ä»¶è¿˜åŸåˆ° path ç›®å½•ï¼Œä»è€Œå‡å°‘æµæ°´çº¿è¿è¡Œæ—¶é—´
        # è‹¥ key æ²¡å‘½ä¸­ç¼“å­˜æ—¶ï¼Œåœ¨å½“å‰JobæˆåŠŸå®Œæˆæ—¶å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°ç¼“å­˜
        # ç¼“å­˜å‘½ä¸­ç»“æœä¼šå­˜å‚¨åœ¨steps.[id].outputs.cache-hité‡Œï¼Œè¯¥å˜é‡åœ¨ç»§åçš„stepä¸­å¯è¯»
        id: cache-dependencies
        uses: actions/cache@v3
        with:
          # ç¼“å­˜æ–‡ä»¶ç›®å½•çš„è·¯å¾„
          path: |
            **/node_modules
          # keyä¸­å®šä¹‰ç¼“å­˜æ ‡å¿—ä½çš„ç”Ÿæˆæ–¹å¼ã€‚runner.OSæŒ‡å½“å‰ç¯å¢ƒçš„ç³»ç»Ÿã€‚å¤–åŠ å¯¹yarn.lockå†…å®¹ç”Ÿæˆå“ˆå¸Œç ä½œä¸ºkeyå€¼ï¼Œå¦‚æœyarn.lockæ”¹å˜åˆ™ä»£è¡¨ä¾èµ–æœ‰å˜åŒ–ã€‚
          # è¿™é‡Œç”¨yarn.lockè€Œä¸æ˜¯package.jsonæ˜¯å› ä¸ºpackage.jsonä¸­è¿˜æœ‰versionå’Œdescriptionä¹‹ç±»çš„æè¿°é¡¹ç›®ä½†å’Œä¾èµ–æ— å…³çš„å±æ€§
          key: ${{runner.OS}}-${{hashFiles('**/yarn.lock')}}

      - name: Installing Dependenciesï¼ˆå®‰è£…ä¾èµ–ï¼‰
        # å¦‚æœç¼“å­˜æ ‡å¿—ä½æ²¡å‘½ä¸­ï¼Œåˆ™æ‰§è¡Œè¯¥stepã€‚å¦åˆ™å°±è·³è¿‡è¯¥step
        if: steps.cache-dependencies.outputs.cache-hit != 'true'
        run: npm run bootstrap

      - name: Running Testï¼ˆè¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼‰
        # é€šè¿‡å‰é¢ç« èŠ‚å®šä¹‰çš„å‘½ä»¤è¡Œæ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
        run: npm run test

        - name: Run the tests and generate coverage reportï¼ˆç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼‰
        run: |
          npm run codecov

      - name: Upload coverage reports to Codecovï¼ˆä¸Šä¼ ä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼‰
        uses: codecov/codecov-action@v4.0.1
        with:
          token: ${{ secrets.CODECOV_TOKEN }}
